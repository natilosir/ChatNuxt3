import{_ as U}from"./BDV1AlzY.js";import{r as m,i as A,h as I,y as V,c,o as r,a as e,b as g,w as y,d as $,m as k,t as h,g as N,E as M,T as S,_ as z,f as H,v as q,l as F,B as E,F as O,A as G,H as x,I as K,z as j,n as T}from"./CI--yoU-.js";import{A as D,M as P,s as Q,i as R}from"./DmZ9LRu2.js";import{p as B}from"./DSqpYqpb.js";import{S as W}from"./BQIkj5Wb.js";import{u as J}from"./BhqzRmtz.js";const X={class:"app-header"},Y={class:"header-content"},Z={class:"header-right"},ee={key:0,class:"select-chat"},se={class:"user-info"},te={class:"avatar"},ae={class:"username"},le={class:"menu-header"},ie={class:"avatar large"},ne={class:"user-details"},oe={__name:"ChatHeader",props:{user:{type:Object,required:!0}},emits:["logout"],setup(p){const u=m(!1),f=m(null),d=m(null);A(D,n=>{f.value=n},{immediate:!1}),A(P,n=>{d.value=n.user},{immediate:!1});const i=n=>n?n.substring(0,1).toUpperCase():"",o=()=>{u.value=!u.value},v=n=>{if(u.value){const a=document.querySelector(".profile-menu");a&&!a.contains(n.target)&&(u.value=!1)}};return I(()=>{document.addEventListener("click",v)}),V(()=>{document.removeEventListener("click",v)}),(n,a)=>{var _,t,s,l;const b=U;return r(),c("header",X,[e("div",Y,[g(b,{to:"/",class:"logo"},{default:y(()=>a[4]||(a[4]=[e("i",{class:"bi bi-chat-dots-fill"},null,-1),$(),e("span",null,"ChatLand",-1)])),_:1,__:[4]}),e("div",Z,[d.value?(r(),c("div",ee,h((_=d.value)==null?void 0:_.username)+" - "+h((t=d.value)==null?void 0:t.name),1)):k("",!0),e("div",{class:"profile-menu",onClick:N(o,["stop"])},[e("div",se,[e("div",te,h(i((s=f.value)==null?void 0:s.user.username)),1),e("span",ae,h((l=f.value)==null?void 0:l.user.name),1),e("i",{class:M(["bi bi-chevron-down menu-icon",{"rotate-180":u.value}])},null,2)]),g(S,{name:"slide-fade"},{default:y(()=>{var C,w;return[u.value?(r(),c("div",{key:0,class:"dropdown-menu",onClick:a[2]||(a[2]=N(()=>{},["stop"]))},[e("div",le,[e("div",ie,h(n.userInitials),1),e("div",ne,[e("h4",null,h((C=p.user)==null?void 0:C.username),1),e("p",null,h((w=p.user)==null?void 0:w.email),1)])]),a[7]||(a[7]=e("hr",null,null,-1)),g(b,{to:"/profile",class:"menu-item",onClick:a[0]||(a[0]=L=>u.value=!1)},{default:y(()=>a[5]||(a[5]=[e("i",{class:"bi bi-pencil-square"},null,-1),$(" ویرایش پروفایل ")])),_:1,__:[5]}),g(b,{to:"/settings",class:"menu-item",onClick:a[1]||(a[1]=L=>u.value=!1)},{default:y(()=>a[6]||(a[6]=[e("i",{class:"bi bi-gear"},null,-1),$(" تنظیمات حساب ")])),_:1,__:[6]})])):k("",!0)]}),_:1})]),e("button",{onClick:a[3]||(a[3]=C=>n.$emit("logout")),class:"logout-btn"},a[8]||(a[8]=[e("i",{class:"bi bi-box-arrow-right"},null,-1),$(),e("span",{class:"logout-text"},"خروج",-1)]))])])])}}},re={class:"app-sidebar"},ce={class:"sidebar-header"},ue={class:"search-container"},de={class:"search-box"},ve={key:0,class:"load"},he={key:1,class:"chat-room"},me={class:"chat-list"},fe=["onClick"],be={class:"chat-avatar"},_e={class:"chat-info"},pe={class:"chat-name"},ge={class:"chat-last-msg"},Ce={class:"chat-time"},ye={key:2,class:"load"},ke={__name:"ChatSidebar",props:{activeChat:{type:String,default:null},isMobile:{type:Boolean,default:!1}},emits:["select-chat","close-sidebar"],setup(p,{emit:u}){const f=p,d=u,i=m(""),o=m([]),v=m(!1),n=async()=>{try{v.value=!0;const t=await B("GetChatsData",{});D.value=t,t!=null&&t.chats&&Array.isArray(t.chats)&&(o.value=t.chats.map(s=>({hash:s.hash,username:s.username,lastMessage:s.last_message.text,time:s.last_message.created_at})))}catch(t){console.error("خطا در دریافت چت‌ها:",t),o.value=[]}finally{v.value=!1}},a=t=>t?t.substring(0,1).toUpperCase():"",b=t=>{d("select-chat",t),f.isMobile&&d("close-sidebar")},_=async()=>{if(i.value)try{v.value=!0;const t=await B("CreateChat",{username:i.value});t!=null&&t.hash&&(o.value.unshift({hash:t.hash,username:i.value,lastMessage:"",time:chat.updated_at}),b(t.hash),i.value="")}catch(t){W.fire({icon:"error",title:`خطای ${t.status}`,text:t.data.error,position:"top-end",toast:!0,showConfirmButton:!1,timer:2e3,timerProgressBar:!0})}finally{v.value=!1}};return I(()=>{n()}),(t,s)=>(r(),c("aside",re,[e("div",ce,[p.isMobile?(r(),c("button",{key:0,onClick:s[0]||(s[0]=l=>t.$emit("close-sidebar")),class:"close-btn"},s[2]||(s[2]=[e("i",{class:"bi bi-x-lg"},null,-1)]))):k("",!0)]),e("div",ue,[e("div",de,[s[3]||(s[3]=e("i",{class:"bi bi-search"},null,-1)),H(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>i.value=l),onKeyup:F(_,["enter"]),type:"text",placeholder:"جستجوی کاربران"},null,544),[[q,i.value]])]),e("button",{onClick:_,class:"new-chat-btn"},s[4]||(s[4]=[e("i",{class:"bi bi-plus-lg"},null,-1)]))]),v.value?(r(),c("div",ve,s[5]||(s[5]=[E('<div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div>',5)]))):o.value?(r(),c("div",he,[e("div",me,[(r(!0),c(O,null,G(o.value,l=>(r(),c("div",{key:l.hash,class:M(["chat-item",{active:p.activeChat===l.hash}]),onClick:C=>b(l.hash)},[e("div",be,h(a(l.username)),1),e("div",_e,[e("span",pe,h(l.username),1),e("span",ge,h(l.lastMessage||"آخرین پیام..."),1)]),e("div",Ce,h(l.time||"12:30"),1)],10,fe))),128))])])):(r(),c("div",ye,s[6]||(s[6]=[E('<div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div><div class="circle" data-v-b73812bf></div>',5)])))]))}},we=z(ke,[["__scopeId","data-v-b73812bf"]]),$e={class:"main-content"},Me={key:0,class:"chat-view"},Ne={__name:"chat",setup(p){J({title:"چت‌لند"});const u=m({username:"",hash:""}),f=m([]),d=m(null),i=m(!1),o=m(!1);let v=null;const n=()=>{i.value=window.innerWidth<768,R.value=i.value},a=async()=>{try{const s=await B("GetChatsData",{});s!=null&&s.chats&&Array.isArray(s.chats)&&(f.value=s.chats.map(l=>({hash:l.hash,username:l.username,lastMessage:"",time:new Date().toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"})})))}catch(s){console.error("خطا در دریافت چت‌ها:",s)}};I(()=>{n(),window.addEventListener("resize",n),a(),v=Q(a,9e4)}),V(()=>{window.removeEventListener("resize",n),clearInterval(v)});const b=()=>{o.value=!o.value},_=s=>{d.value=s,T(`/chat/${s}`),i.value&&(o.value=!1)},t=()=>{T("/logout")};return x("chats",f),x("activeChat",d),x("selectChat",_),(s,l)=>{const C=oe,w=we;return r(),c("div",{class:M(["app-container",{"mobile-view":i.value}])},[g(C,{user:u.value,onLogout:t},null,8,["user"]),e("div",$e,[g(S,{name:"slide-fade"},{default:y(()=>[!i.value||!o.value?(r(),c("main",Me,[K(s.$slots,"default")])):k("",!0)]),_:3}),g(S,{name:"slide-fade"},{default:y(()=>[!i.value||o.value?(r(),j(w,{key:0,chats:f.value,activeChat:d.value,isMobile:i.value,onSelectChat:_,onCloseSidebar:l[0]||(l[0]=L=>o.value=!1)},null,8,["chats","activeChat","isMobile"])):k("",!0)]),_:1}),i.value?(r(),c("button",{key:0,onClick:b,class:"sidebar-toggle-btn"},[e("i",{class:M(["bi",o.value?"bi-x-lg":"bi-list"])},null,2)])):k("",!0)])],2)}}};export{Ne as default};
